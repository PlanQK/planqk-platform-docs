(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{360:function(e,t,s){"use strict";s.r(t);var r=s(7),a=Object(r.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"report-service-usage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#report-service-usage"}},[e._v("#")]),e._v(" Report Service Usage")]),e._v(" "),t("p",[e._v("To charge your customers for using your service, you need to report the usage to our Metering API.\nThe PlanQK Platform aggregates all reported usage events and charges your customers at the end of each month.")]),e._v(" "),t("h3",{attrs:{id:"authentication"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#authentication"}},[e._v("#")]),e._v(" Authentication")]),e._v(" "),t("p",[e._v("The Metering API uses access tokens to authenticate requests.\nYou can view and manage your personal access tokens in your "),t("a",{attrs:{href:"https://platform.planqk.de/settings/access-tokens",target:"_blank",rel:"noopener noreferrer"}},[e._v("settings"),t("OutboundLink")],1),e._v(".\nFor authentication, provide your access token in the "),t("code",[e._v("X-Auth-Token")]),e._v(" header field for each request.")]),e._v(" "),t("h3",{attrs:{id:"post-qc-catalog-external-services-metering"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#post-qc-catalog-external-services-metering"}},[e._v("#")]),e._v(" "),t("code",[e._v("POST /qc-catalog/external-services/metering")])]),e._v(" "),t("p",[e._v("This endpoint is used to report the usage of your on-premise service.\nThe request body must contain a "),t("code",[e._v("correlationId")]),e._v(", which is forwarded by the PlanQK API Gateway upon service execution.\nThe PlanQK Platform then logs a usage event for the corresponding product item ("),t("code",[e._v("productId")]),e._v(") and the submitted count.")]),e._v(" "),t("p",[t("strong",[e._v("Request Body:")])]),e._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"correlationId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"string"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"productId"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"string"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"count"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br")])]),t("ul",[t("li",[e._v("The "),t("code",[e._v("correlationId")]),e._v(" is needed to correlate your reported usage to the corresponding user of your service.\nYou can obtain the correlation id from the "),t("code",[e._v("x-correlation-id")]),e._v(" header of the request that was forwarded by our API Gateway to your service.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("productId")]),e._v(" is the id of the product you want to report.\nYou can find the id of your product in the pricing plan table on the service details page.")]),e._v(" "),t("li",[e._v("The "),t("code",[e._v("count")]),e._v(" is the quantity of units you want to report.")])]),e._v(" "),t("p",[t("strong",[e._v("Example:")])]),e._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-X")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'POST'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'https://platform.planqk.de/qc-catalog/external-services/metering'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-H")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Accept: */*'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-H")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'Content-Type: application/json'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-H")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'X-Auth-Token: <your access token>'")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-d")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('\'{\n    "correlationId": "bXlleHRlcm5hbHNlcnZpY2VuYW1lOnRoZWFwcGxpY2F0aW9ubmFtZXRoYXRpc3N1YnNjcmliZWQ=",\n    "productId": "prod_YX8skS2X",\n    "count": 10\n}\'')]),e._v("\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br")])]),t("h3",{attrs:{id:"test-your-metering-logic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#test-your-metering-logic"}},[e._v("#")]),e._v(" Test your metering logic")]),e._v(" "),t("p",[e._v("To verify that your service is correctly reporting usage to the Metering API, you can use the Metering Test Mode.")]),e._v(" "),t("p",[e._v("You can use the test mode by following these steps:")]),e._v(" "),t("ol",[t("li",[e._v("On the service details page, click on "),t("code",[e._v("Publish Internal")]),e._v(". This will make your service accessible only to you.")]),e._v(" "),t("li",[e._v("Subscribe to the service using one of your "),t("a",{attrs:{href:"https://platform.planqk.de/applications",target:"_blank",rel:"noopener noreferrer"}},[e._v("Applications"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("Execute the service.")]),e._v(" "),t("li",[e._v("Your service logic need to obtain the correlation id from the "),t("code",[e._v("x-correlation-id")]),e._v(" header of the request that was forwarded by our API Gateway to your service.")]),e._v(" "),t("li",[e._v("Meter the usage of your service by calling the Metering API with the correlation id you obtained in the previous step.")]),e._v(" "),t("li",[e._v("On the service details page, click on "),t("code",[e._v("Metering Events")]),e._v(". This will show you the metering events that were reported to our Metering API.")])])])}),[],!1,null,null,null);t.default=a.exports}}]);